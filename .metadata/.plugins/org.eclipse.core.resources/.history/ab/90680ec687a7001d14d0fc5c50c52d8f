<%@page import="java.util.ArrayList,
test.employee.Employee,
test.employee.Manager,
test.employee.Engineer,
test.employee.Sales"%>
<%@page import="java.util.HashSet"%>
<%@ page language="java" contentType="text/html; charset=UTF-8"
    pageEncoding="UTF-8"%>
<jsp:useBean id="empList" class="java.util.ArrayList" scope="session" />
<jsp:useBean id="emp1" class="test.employee.Manager" scope="request"/> 
<jsp:setProperty property="*" name="emp1" />
<jsp:useBean id="emp2" class="test.employee.Engineer" scope="request"/> 
<jsp:setProperty property="*" name="emp2" />
<jsp:useBean id="emp3" class="test.employee.Sales" scope="request"/> 
<jsp:setProperty property="*" name="emp3" />
<!DOCTYPE html>
<html>
<% 
	// new Manager(), new Engineer(), new Sales()
	String position = request.getParameter("position"); //->M, E, S
	Employee e = null;
	if(position.equals("M"))   e = new Manager();
	else if(position.equals("E"))   e = new Engineer();
	else if(position.equals("S"))   e = new Sales();
	HashSet empSet = new HashSet(empList);
	// 객체를 통해 해당 클래스를 얻어올 때 : getClass() -> Class 타입의 객체
	// 클래스 전체이름에 .class를 붙이면 해당 클래스를 클래스로 로딩함.
	if(e instanceof Manager) 
	{	empSet.add(emp1); 
	    System.out.println("postEmp.jsp after action\n" + emp1);
	}else if(e instanceof Engineer) 
	{	empSet.add(emp2); 
    	System.out.println("postEmp.jsp after action\n" + emp2);
	}else if(e instanceof Sales) 
	{	empSet.add(emp3); 
		System.out.println("postEmp.jsp after action\n" + emp3);
	}
	// getClass()사용
//	if(emp1.getClass().equals(e.getClass())   )
//		empSet.add(emp1);
//	else if(emp2.getClass().equals(e.getClass())   )
//		empSet.add(emp2);
//	else if(emp3.getClass().equals(e.getClass())   )
//		empSet.add(emp3);
	
	
	
	//중복 제거를 위한 코드 : empList를 HashSet으로 만들어서 add()를 실행
								// <- 기존값을 새로운 값으로 대체.(* : 기존값 유지하도록)
//	empList = new ArrayList(empSet);
	empList.clear();
	empList.addAll(empSet);
	System.out.println("-----------start :: empList::postEmp.jsp---------------");
	for(Object o: empList)
	{	System.out.println(o);
	}
	System.out.println("-----------end :: empList::postEmp.jsp---------------");
%>
<head><meta charset="UTF-8">
<title>방명록 게시판</title>
</head>
<body>
<%
//emp.getId().equals("root")

%>

[<jsp:getProperty property="name" name="emp1"/>] 직원등록이 완료되었습니다.<br>
총직원은 [<%=empList.size() %>] 명입니다.<br>

<a href="listEmp.jsp">게시판가기</a>
</body>
</html>