package test.employee;

import java.io.File;
import java.io.FileInputStream;
import java.io.FileOutputStream;
import java.io.IOException;
import java.io.ObjectInputStream;
import java.io.ObjectOutputStream;
import java.util.HashMap;

public class RWEmpData {
	
	@SuppressWarnings("unchecked")
	public HashMap<String, Employee> readEmps()
	{
		HashMap<String, Employee> hashMap;
		try {
			FileInputStream fileStream = new FileInputStream("./employees.txt");
			ObjectInputStream objectInputStream = new ObjectInputStream(fileStream);
			Object object = objectInputStream.readObject();
			objectInputStream.close();
			hashMap = (HashMap<String, Employee>)object;
//			
		} catch (IOException e) {
			hashMap = new HashMap<String ,Employee>();
			e.printStackTrace();
		} catch (ClassNotFoundException e) {
			hashMap = new HashMap<String ,Employee>();
			e.printStackTrace();
		}
		
//		Iterator<String> it = hashMap.keySet().iterator();
//		while(it.hasNext()){  // 맵키가 존재할경우
//			String key = it.next();  // 맵키를 꺼냄
//			Employee value = (Employee)hashMap.get(key);  // 키에 해당되는 객체 꺼냄
//			System.out.println(key + "->" + value);
//		}
		return hashMap;
	}
	
	public void writeEmp(Employee emp) throws IOException
	{
		File file = new File("./employees.txt");
		HashMap<String, Employee> emps = readEmps();
		emps.put(emp.getNo(), emp);
		System.out.println("fileout");
		FileOutputStream fileStream = new FileOutputStream(file, true);
		System.out.println("objout");
		ObjectOutputStream objectOutputStream = new ObjectOutputStream(fileStream);
		System.out.println("objwrite");
		objectOutputStream.writeObject(emps);
		System.out.println("objclose");
		objectOutputStream.close();
		System.out.println(emps);
	}
}